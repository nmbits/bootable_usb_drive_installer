# Bootable USB drive installer

## はじめに
このスクリプトは、ファイルサーバ等長時間運用に適したブート可能なUSBドライブを作成します。

## 特徴
1. USBドライブはoverlayfs(overlayroot)により保護されます。USBドライブに対する変更はtmpfsに格納され、USBドライブにデータがライトされることはありません。
2. tmpfsに格納された変更は、シャットダウン時にUSBドライブに適用されます。

## 前提条件
* インストールに使うPC: USBポートを搭載するDebian amd64システム。btrfs-progs, debootstrapがインストールされていること。
* USB Drive: 1GB程度(目的に応じて増減)のUSBドライブ
* USB Driveを起動するPC:
  * UEFIをサポートするX86_64
  * 少なくともルートファイルシステムへの変更量(最大: ファイルシステムサイズ)を格納できるメモリ

## 使い方
1. このディレクトリのすべてのファイルを一つの任意のディレクトリに格納してください。
2. USBドライブを用意し、そのパーティションをすべて削除してください。
3. 以下のコマンドを実行してください。
   > sudo sh install.sh /path/to/USB/drive/device_file
4. パスワードを聞かれたら、USBドライブに設定するrootのパスワードを入力してください。
5. スクリプトが終了したら、USBを目的のPCに挿入し、USBドライブから起動してください。
6. rootでログインし、ネットワークの設定やパッケージのインストールを行ってください。
7. シャットダウンして、変更内容をUSBドライブに反映してください。
8. USBドライブで再起動し、変更が反映されていることを確認してください。

## 注意点
1. シャットダウンの度に、ルートファイルシステムのスナップショットが作成されます。スナップショットの名前は@.数字です。数字は、現在のスナップショットの最大値+1になります。
2. 起動時、数字が最大のスナップショットがルートファイルシステムとなります。
3. 古いスナップショットは自動では削除されません。必要であれば適宜スナップショットを削除してください。

## ライセンス
GPL v2
